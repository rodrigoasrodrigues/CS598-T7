<!doctype html>
<html lang="en">

{% include 'head.html' %}

<body class="bg-light">
    <div class="container">
        <div class="py-5 text-center">
            <h2>Explore the dataset</h2>
        </div>
        <div class="jumbotron p-4">
            <div class="row">
                <div class="col-md-3"><a href="/" class="btn btn-lg btn-secondary btn-block" role="button">Back </a>
                </div>
                <div class="col-md-3"><strong>Dataset:</strong><br /> {{ model.dataset.name }}</div>
                <div class="col-md-3"><strong>Labels:</strong><br /> {{ model.label.name }}</div>
                <div class="col-md-3"><strong>Threshold:</strong> 0.5<br />
                    <input type="range" class="custom-range" id="customRange1">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3 mb-4">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-muted">Positive Words</span>
                </h4>
                <form class="mb-3">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="search">
                    </div>
                </form>
                <div class='list-overflow'>
                    {{selected}}
                    <ul class="list-group mb-1">
                        {% for word in words %}
                        {% if word[1] != selected %} <a href="/explore/{{model.id}}/{{word[1]}}" class="dataset-link">
                            {% endif %}
                            <li
                                class="list-group-item d-flex justify-content-between lh-condensed pt-1 pb-1  {% if  word[1]==selected%} bg-light selected-model {% endif %} ">
                                <div>
                                    <span class="my-0">{{word[1]}}</span>
                                </div>
                                <span class="text-muted score">{{"%.2f"|format(word[0])}}</span>
                            </li>
                            {% if word is not sameas selected %} </a>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </div>

            </div>
            <div class="col-md-3 mb-4">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-muted">Related Words</span>
                </h4>

                <div class='list-overflow related-words'>
                    <ul class="list-group mb-1 ">
                        {% for word in related_words %}
                        <li class="list-group-item d-flex justify-content-between lh-condensed pt-1 pb-1">
                            <div>
                                <span class="my-0">{{word[1]}}</span>
                            </div>
                            <span class="text-muted score">{{"%.2f"|format(word[0])}}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

            </div>
            <div class="col-md-6">
                <h4 class="mb-3">graph</h4>
                <canvas width="600" height="600"></canvas>

            </div>
        </div>
        {% include 'footer.html' %}
    </div>
</body>
<script>

var canvas = document.querySelector("canvas"),
    context = canvas.getContext("2d"),
    width = canvas.width,
    height = canvas.height;

var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; }))
    .force("charge", d3.forceManyBody())
    .force("center", d3.forceCenter(width / 2, height / 2));

d3.json("/static/miserables.json", function(error, graph) {
  if (error) throw error;

  simulation
      .nodes(graph.nodes)
      .on("tick", ticked);

  simulation.force("link")
      .links(graph.links);

  d3.select(canvas)
      .call(d3.drag()
          .container(canvas)
          .subject(dragsubject)
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));

  function ticked() {
    context.clearRect(0, 0, width, height);

    context.beginPath();
    graph.links.forEach(drawLink);
    context.strokeStyle = "#aaa";
    context.stroke();

    context.beginPath();
    graph.nodes.forEach(drawNode);
    context.fill();
    context.strokeStyle = "#fff";
    context.stroke();


  }

  function dragsubject() {
    return simulation.find(d3.event.x, d3.event.y);
  }
});

function dragstarted() {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d3.event.subject.fx = d3.event.subject.x;
  d3.event.subject.fy = d3.event.subject.y;
}

function dragged() {
  d3.event.subject.fx = d3.event.x;
  d3.event.subject.fy = d3.event.y;
}

function dragended() {
  if (!d3.event.active) simulation.alphaTarget(0);
  d3.event.subject.fx = null;
  d3.event.subject.fy = null;
}

function drawLink(d) {
  context.moveTo(d.source.x, d.source.y);
  context.lineTo(d.target.x, d.target.y);
}

function drawNode(d) {
  context.moveTo(d.x + 3, d.y);
  context.arc(d.x, d.y, 3, 0, 2 * Math.PI);
  context.fillText("Hello World", d.x, d.y);

}

    </script>
</html>